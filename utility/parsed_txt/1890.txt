Question: Departmental Website phpCAS upgrade
Article Text: If your PHP application hosted by the UH Departmental Hosted Website Service is using the server provided library phpCAS, a major vulnerability was reported in recent months requiring an update. We have tenatitvely scheduled the update for Monday, July 10, 2023 at 9:00am. The unfortunate part of the security update is that the parameters in the call to initialize phpCAS (phpCAS::client) are different and incompatible with the parameters used in the previous versions. Because of this you'll need two different initialization calls in your code, one to be used up until phpCAS is upgraded, and one to be used after the upgrade. Here's some code you can use to update your application: (code additions are shown in bold) if (version_compare(phpCAS::getVersion(), '1.6.0', '<')) phpCAS::client( CAS_VERSION_2_0, $cas_host, $cas_port, $cas_context ); else phpCAS::client( CAS_VERSION_2_0, $cas_host, $cas_port, $cas_context, 'https://www.hawaii.edu' ); This code checks the version of phpCAS being used. If older than version 1.6.0, it runs the original phpCAS::client line. If version 1.6.0 or newer, it adds the client service name as the final parameter. The URL used in this parameter (above, 'https://www.hawaii.edu') has the protocol, domain, and port of the page calling the function. So for example, if your website is hosted at https://manoa.hawaii.edu/mysite/, the client service name should be: 'https://manoa.hawaii.edu'. To help you test your site against the new phpCAS library, we have setup test servers where your live php code is using the updated phpCAS library. Finally if you have any questions about the phpCAS upgrade, please contact web support at web-support-l@lists.hawaii.edu Setting up your computer to test the new version of phpCAS The first step is to point your computer's hosts file to the test webserver directly. This is accomplished differently depending on which Operating System you are using. Windows Setup Mac Setup Linux Setup Windows Setup Open your favorite text editor such as Notepad as an administrator (right-click, run as administrator). From your text editor, open up your computer's hosts file. You will find your hosts file here: %systemroot%\system32\drivers\etc\hosts (%systemroot% is usually c:\windows\ but may be somewhere else if your Windows was set up differently.) If your website is hosted on one of the domains shown below, add the line as shown. If not, please contact web-support-l@lists.hawaii.edu with your domain name and we will let you know what your line should be. 128.171.149.219 www.hawaii.edu 128.171.149.220 manoa.hawaii.edu 128.171.149.221 hawaii.hawaii.edu 128.171.149.222 maui.hawaii.edu 128.171.149.223 uhcc.hawaii.edu Save the file (for Notepad: from the menu, File -> Save or ctrl+s), and when you open your browser to your website, it will now point to the test webservers running the newest version of phpCAS. You can test compatibility by going to your website, and doing what you regularly do on your website and seeing if any errors arise. If everything works fine, you're all set. After you complete testing, remember to remove the line from your hosts file that you added in step three to have your browsers point back to the production websites. Mac Setup Open your Terminal app. For most users, this is under Applications Folder -> Utilities Folder In Terminal, your first step is to open your hosts file with your console's text editor as Super User. This can be done by typing the following into the Terminal app: sudo nano /private/etc/hosts Next, you will need to update your hosts file by adding your website's domain to it. If your website is hosted on one of the domains shown below, add the line as shown. If not, please contact web-support-l@lists.hawaii.edu with your domain name and we will let you know what your line should be. 128.171.149.219 www.hawaii.edu 128.171.149.220 manoa.hawaii.edu 128.171.149.221 hawaii.hawaii.edu 128.171.149.222 maui.hawaii.edu 128.171.149.223 uhcc.hawaii.edu Add the appropriate line above to your hosts file then to save the file, Hit ctrl+x, type 'y', and press enter. After the file has been saved, the next time you open your browser and visit your website, it will now point to the test webservers running the newest version of phpCAS. You can test compatibility by going to your website, and doing what you regularly do on your website and seeing if any errors arise. If everything works fine, you're all set. After you complete testing, remember to remove the line from your hosts file that you added in Terminal to stop your browsers from pointing at the test webserver. Linux Setup Open up your favorite text editor with Super User (root) access. From your text editor, open up your computer's hosts file. You will typically find your hosts file here: /etc/hosts If your website is hosted on one of the domains shown below, add the line as shown. If not, please contact web-support-l@lists.hawaii.edu with your domain name and we will let you know what your line should be. 128.171.149.219 www.hawaii.edu 128.171.149.220 manoa.hawaii.edu 128.171.149.221 hawaii.hawaii.edu 128.171.149.222 maui.hawaii.edu 128.171.149.223 uhcc.hawaii.edu Save the file, and when you open your browser to your website, it will now point to the test webservers running the newest version of phpCAS. You can test compatibility by going to your website, and doing what you regularly do on your website and seeing if any errors arise. If everything works fine, you're all set. After you complete testing, make sure you remember to remove the line from your hosts file and save to have your browsers point back to the production websites.
