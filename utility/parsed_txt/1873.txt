Question: Virtual Server: Dual-Homed to Single-Homed Network Conversion (Linux)
Article Text: SUMMARY: In the past, virtual servers were provisioned with both a public and a private network ("dual-homed"). ITS will be removing the use to the private network, and self-managed VM customers will need to complete the following steps to remove the private network on their server. NOTE: You should contact itscs@hawaii.edu at least 1-2 business days before you plan this, as modifying the private network may cause a downtime to other services or hosts that your server connects to. ITS may also need to modify additional firewall rules on your VM, so if you have critical services that need to be up, it is best that you coordinate this with us ahead of time. You may also request for a snapshot of the server first to allow us to revert back in case a file is deleted or modified in error. As the root user, run the "ifconfig" command. You should get an output similar to the following. # ifconfig eno16780032: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500 inet 166.122.3.161 netmask 255.255.255.0 broadcast 166.122.3.255 inet6 fe80::250:56ff:feb0:2ddd prefixlen 64 scopeid 0x20<link> ether 00:50:56:b0:2d:dd txqueuelen 1000 (Ethernet) RX packets 1185 bytes 102807 (100.3 KiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 198 bytes 23317 (22.7 KiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 ens224: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500 inet 172.17.36.14 netmask 255.255.255.0 broadcast 172.17.36.255 inet6 fe80::250:56ff:feb0:5673 prefixlen 64 scopeid 0x20<link> ether 00:50:56:b0:56:73 txqueuelen 1000 (Ethernet) RX packets 689 bytes 146959 (143.5 KiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 688 bytes 89245 (87.1 KiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 lo: flags=73<UP,LOOPBACK,RUNNING> mtu 65536 inet 127.0.0.1 netmask 255.0.0.0 inet6 ::1 prefixlen 128 scopeid 0x10<host> loop txqueuelen 1 (Local Loopback) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 0 bytes 0 (0.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 Note the highlighted line above with "ens224" and the highlighted IP address as a 172.17.*.* IP. This indicates that "ens224" is the private network interface, and your server may have a different name such as "eth1". Ensure the IP address starts with "172.17.*.*", which indicates that it's a private IP. Edit the /etc/resolv.conf file using the command "vi /etc/resolv.conf" Change the "nameservers" lines to use 192.168.10.115 and 192.168.10.116 like in the example below: Save the file and exit. Delete the following file: /etc/sysconfig/network-scripts/ifcfg-<name>, where <name> is the name of the private network interface from the "ifconfig" command". For example, "rm /etc/sysconfig/network-scripts/ifcfg-eth1" WARNING: Be sure to check if the file does contain the private IP first or you may be accidentally deleting the public IP! Delete the following file: /etc/sysconfig/network-scripts/route-<name>, where <name> is the name of the private network interface from the "ifconfig" command". For example, "rm /etc/sysconfig/network-scripts/route-eth1" if the interface's name is "eth1" Edit /etc/sysconfig/network and ensure the gateway points to the gateway IP of the public network. If you are not sure what the public gateway is, email itscs@hawaii.edu. Example below of the file referring to the public gateway and the public network interface, eth0: Email itscs@hawaii.edu that you have disabled the private network and removed the static routes. We will then remove the NIC from the VM, and modify additional firewall rules on our end if needed. Once we've confirmed removing the NIC from the VM, restart the VM and SSH back in. If you are unable to use SSH, access the VM from the vCenter console. Please note that if the server needs to connect to critical services, this part may not work unless we modify the firewall rules. Therefore, it would be best if we are contacted during business hours to ensure this is completed. Re-register the server with Katello to continue to get Linux updates: https://www.hawaii.edu/askus/1752 RELATED ARTICLES: Virtual Server: Dual-Homed to Single-Homed Network Conversion (Windows)
